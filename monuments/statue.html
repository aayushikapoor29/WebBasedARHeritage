<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taj Mahal - AR Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MODEL-VIEWER: This loads 3D GLB models -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>
    
    <style>
        model-viewer {
            width: 100%;
            height: 500px;
            background: linear-gradient(to bottom, #fef3c7, #fde68a);
            border-radius: 16px;
        }
        
        #arOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
        }
        
        #arVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #arCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-50 min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Monument Header -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-6">
            <!-- Monument Info -->
            <div class="bg-gradient-to-r from-orange-100 to-amber-100 p-6">
                <h1 class="text-3xl font-bold text-gray-900"> KRISHNA STATUE </h1>
                <p class="text-lg text-gray-700">üìç Wagholi, Maharashtra </p>
            </div>

            <!-- 3D MODEL VIEWER - THIS LOADS THE GLB FILE -->
            <div class="p-4">
                <h3 class="text-lg font-semibold mb-2 text-center">üé® 3D Model View</h3>
                <model-viewer
                    id="tajModel"
                    src="../models/statue.glb"
                    alt="Krishna Statue 3D Model"
                    ar
                    ar-modes="webxr scene-viewer quick-look"
                    camera-controls
                    auto-rotate
                    shadow-intensity="1"
                    environment-image="neutral"
                    style="border: 3px solid #f97316;">
                    
                    <button slot="ar-button" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold absolute bottom-4 right-4">
                        üì± View in AR
                    </button>
                </model-viewer>
                <p class="text-center text-sm text-gray-600 mt-2">
                    ‚òùÔ∏è Drag to rotate ‚Ä¢ Scroll to zoom ‚Ä¢ On mobile: tap "View in AR"
                </p>
            </div>

            <!-- Monument Information -->
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <span class="text-sm font-semibold text-orange-600">BUILT IN</span>
                        <p class="text-2xl font-bold text-gray-900">2026</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <span class="text-sm font-semibold text-orange-600">PERIOD</span>
                        <p class="text-2xl font-bold text-gray-900">21st century</p>
                    </div>
                </div>

                <div class="mb-6">
                    <span class="text-sm font-semibold text-orange-600">üìñ ABOUT</span>
                    <p class="text-gray-700 mt-2 leading-relaxed">
                        bhagwan ji ki kripa
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Labore dolores iure asperiores nesciunt, ut blanditiis cum, sunt enim debitis quaerat corporis qui voluptatum praesentium vitae consequuntur reprehenderit officia explicabo fugit?
                    </p>
                </div>

                <div class="mb-6">
                    <span class="text-sm font-semibold text-orange-600">‚ú® ARCHITECTURAL HIGHLIGHTS</span>
                    <ul class="mt-2 space-y-2 text-gray-700">
                        <li>‚Ä¢ Central dome rises to 73 meters (240 ft)</li>
                        <li>‚Ä¢ Four minarets stand at each corner, each 40 meters tall</li>
                        <li>‚Ä¢ Intricate marble inlay work with semi-precious stones</li>
                        <li>‚Ä¢ Perfect symmetry in design and layout</li>
                        <li>‚Ä¢ Reflects different colors throughout the day</li>
                    </ul>
                </div>

                <!-- MODULE 3: AUDIO GUIDE -->
                <div class="bg-purple-50 border-2 border-purple-200 p-4 rounded-lg mb-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-sm font-semibold text-purple-900">üîä AUDIO GUIDE</span>
                            <p class="text-sm text-purple-700">Listen to detailed history</p>
                        </div>
                        <button id="audioBtn" onclick="toggleAudio()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold transition-all">
                            ‚ñ∂Ô∏è Play Audio
                        </button>
                    </div>
                </div>

                <!-- MODULE 1: AR CAMERA OVERLAY -->
                <div class="bg-blue-50 border-2 border-blue-200 p-4 rounded-lg mb-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-sm font-semibold text-blue-900">üì∏ AR OVERLAY MODE</span>
                            <p class="text-sm text-blue-700">See 3D reconstruction on camera</p>
                        </div>
                        <button onclick="startAROverlay()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-all">
                            üéØ Start AR
                        </button>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="flex gap-3">
                    <button onclick="window.location.href='../index.html'" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition-all">
                        ‚Üê Back to Scanner
                    </button>
                    <button onclick="shareMonument()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-semibold transition-all">
                        Share üì§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODULE 1 & 4: AR OVERLAY WITH PHOTO CAPTURE -->
    <div id="arOverlay" class="hidden">
        <video id="arVideo" autoplay playsinline></video>
        <canvas id="arCanvas"></canvas>
        
        <!-- AR Controls -->
        <div class="absolute top-4 left-4 right-4 flex justify-between items-start">
            <div class="bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg">
                <p class="font-semibold">üïå Taj Mahal</p>
                <p class="text-sm">AR Reconstruction Mode</p>
            </div>
            <button onclick="stopAROverlay()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold">
                ‚ùå Close
            </button>
        </div>

        <!-- Bottom Controls -->
        <div class="absolute bottom-4 left-4 right-4">
            <div class="bg-black bg-opacity-70 p-4 rounded-lg">
                <div class="flex justify-around items-center">
                    <button onclick="rotateModel(-15)" class="text-white flex flex-col items-center">
                        <span class="text-2xl">‚Ü∫</span>
                        <span class="text-xs">Rotate Left</span>
                    </button>
                    <button onclick="scaleModel(-0.1)" class="text-white flex flex-col items-center">
                        <span class="text-2xl">‚àí</span>
                        <span class="text-xs">Zoom Out</span>
                    </button>
                    
                    <!-- MODULE 4: PHOTO CAPTURE -->
                    <button onclick="capturePhoto()" class="bg-orange-600 hover:bg-orange-700 text-white px-8 py-8 rounded-full text-3xl">
                        üì∑
                    </button>
                    
                    <button onclick="scaleModel(0.1)" class="text-white flex flex-col items-center">
                        <span class="text-2xl">+</span>
                        <span class="text-xs">Zoom In</span>
                    </button>
                    <button onclick="rotateModel(15)" class="text-white flex flex-col items-center">
                        <span class="text-2xl">‚Üª</span>
                        <span class="text-xs">Rotate Right</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Preview Modal -->
    <div id="photoModal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-[2000] flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full p-6">
            <h3 class="text-2xl font-bold mb-4 text-center">üì∏ Photo Captured!</h3>
            <img id="capturedPhoto" class="w-full rounded-lg mb-4" />
            <div class="grid grid-cols-2 gap-3">
                <button onclick="downloadPhoto()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold">
                    ‚¨áÔ∏è Download
                </button>
                <button onclick="sharePhoto()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                    üì§ Share
                </button>
            </div>
            <button onclick="closePhotoModal()" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                Take Another Photo
            </button>
        </div>
    </div>

    <script>
        // MODULE 3: AUDIO GUIDE (Text-to-Speech)
        let isPlaying = false;
        const audioScript = "This is a very beautifyl statue of Lord Krishna located in Wagholi, Maharashtra. It is known for its intricate design and cultural significance. Visitors can explore the statue and learn about its history through this audio guide.";

        function toggleAudio() {
            const btn = document.getElementById('audioBtn');
            
            if (isPlaying) {
                window.speechSynthesis.cancel();
                btn.innerHTML = '‚ñ∂Ô∏è Play Audio';
                isPlaying = false;
            } else {
                const utterance = new SpeechSynthesisUtterance(audioScript);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.onend = () => {
                    btn.innerHTML = '‚ñ∂Ô∏è Play Audio';
                    isPlaying = false;
                };
                window.speechSynthesis.speak(utterance);
                btn.innerHTML = '‚è∏Ô∏è Pause Audio';
                isPlaying = true;
            }
        }

        // MODULE 1: AR OVERLAY
        let arStream = null;
        let arCanvas, arCtx, arVideo;
        let rotation = 0;
        let scale = 1;
        let animationId;

        async function startAROverlay() {
            try {
                arStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                document.getElementById('arOverlay').classList.remove('hidden');
                arVideo = document.getElementById('arVideo');
                arCanvas = document.getElementById('arCanvas');
                arCtx = arCanvas.getContext('2d');
                
                arVideo.srcObject = arStream;
                arVideo.play();
                
                arVideo.onloadedmetadata = () => {
                    arCanvas.width = arVideo.videoWidth;
                    arCanvas.height = arVideo.videoHeight;
                    drawAROverlay();
                };
            } catch (err) {
                alert('Camera access denied. Please enable camera permissions.');
                console.error(err);
            }
        }

        function drawAROverlay() {
            if (!arStream) return;
            
            arCtx.clearRect(0, 0, arCanvas.width, arCanvas.height);
            
            const centerX = arCanvas.width / 2;
            const centerY = arCanvas.height / 2;
            
            arCtx.save();
            arCtx.translate(centerX, centerY);
            arCtx.rotate((rotation * Math.PI) / 180);
            arCtx.scale(scale, scale);
            
            // Draw Taj Mahal
            drawTajMahal(arCtx);
            
            arCtx.restore();
            
            animationId = requestAnimationFrame(drawAROverlay);
        }

        function drawTajMahal(ctx) {
            // Main structure
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.strokeStyle = '#d4af37';
            ctx.lineWidth = 3;
            
            // Base
            ctx.fillRect(-100, 20, 200, 40);
            ctx.strokeRect(-100, 20, 200, 40);
            
            // Main building
            ctx.fillRect(-80, -40, 160, 60);
            ctx.strokeRect(-80, -40, 160, 60);
            
            // Central dome
            ctx.beginPath();
            ctx.ellipse(0, -60, 50, 30, 0, Math.PI, 0);
            ctx.fill();
            ctx.stroke();
            
            // Spire
            ctx.beginPath();
            ctx.moveTo(-10, -90);
            ctx.lineTo(0, -110);
            ctx.lineTo(10, -90);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Minarets
            [-90, 90].forEach(x => {
                ctx.fillRect(x - 8, -30, 16, 70);
                ctx.strokeRect(x - 8, -30, 16, 70);
                ctx.beginPath();
                ctx.arc(x, -35, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            });
        }

        function rotateModel(angle) {
            rotation += angle;
        }

        function scaleModel(delta) {
            scale = Math.max(0.5, Math.min(2, scale + delta));
        }

        function stopAROverlay() {
            if (arStream) {
                arStream.getTracks().forEach(track => track.stop());
                arStream = null;
            }
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            document.getElementById('arOverlay').classList.add('hidden');
            rotation = 0;
            scale = 1;
        }

        // MODULE 4: PHOTO CAPTURE
        let capturedPhotoData = null;

        function capturePhoto() {
            const photoCanvas = document.createElement('canvas');
            photoCanvas.width = arCanvas.width;
            photoCanvas.height = arCanvas.height;
            const photoCtx = photoCanvas.getContext('2d');
            
            // Draw video frame
            photoCtx.drawImage(arVideo, 0, 0);
            
            // Draw AR overlay
            photoCtx.drawImage(arCanvas, 0, 0);
            
            // Add watermark
            photoCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            photoCtx.fillRect(0, photoCanvas.height - 60, photoCanvas.width, 60);
            photoCtx.fillStyle = 'white';
            photoCtx.font = 'bold 24px Arial';
            photoCtx.fillText('üïå Taj Mahal', 20, photoCanvas.height - 30);
            photoCtx.font = '16px Arial';
            photoCtx.fillText(new Date().toLocaleDateString(), 20, photoCanvas.height - 10);
            
            capturedPhotoData = photoCanvas.toDataURL('image/png');
            document.getElementById('capturedPhoto').src = capturedPhotoData;
            document.getElementById('photoModal').classList.remove('hidden');
        }

        function downloadPhoto() {
            const link = document.createElement('a');
            link.download = `taj-mahal-${Date.now()}.png`;
            link.href = capturedPhotoData;
            link.click();
        }

        function sharePhoto() {
            if (navigator.share) {
                fetch(capturedPhotoData)
                    .then(res => res.blob())
                    .then(blob => {
                        const file = new File([blob], 'taj-mahal.png', { type: 'image/png' });
                        navigator.share({
                            title: 'Taj Mahal AR Experience',
                            text: 'Check out my AR photo at the Taj Mahal!',
                            files: [file]
                        });
                    });
            } else {
                alert('Share feature not supported. Photo has been copied!');
            }
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.add('hidden');
        }

        // Share monument
        function shareMonument() {
            if (navigator.share) {
                navigator.share({
                    title: 'Taj Mahal AR Experience',
                    text: 'Explore the Taj Mahal in AR!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Link copied to clipboard!');
            }
        }

        // Cleanup
        window.addEventListener('beforeunload', () => {
            stopAROverlay();
            if (isPlaying) window.speechSynthesis.cancel();
        });
    </script>
</body>
</html>